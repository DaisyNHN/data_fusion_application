<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ldn.cs.fusion.dao.WealthDao">

    <!-- 新增StaffInofs报表数据 -->
    <insert id="addStaffInfos" parameterType="ldn.cs.fusion.pojo.staff.Staff">
        INSERT INTO tbl_staff_info_original(corporation, categories, position, skill, eventTime, updateTime)
        VALUES
        <foreach collection="staffs" item="staff" separator=",">
            (#{staff.corporation}, #{staff.categories}, #{staff.position}, #{staff.skill}, #{staff.eventTime}, #{staff.updateTime})
        </foreach>
    </insert>

    <!-- 查询StaffInfos报表 -->
    <select id="getStaffInfos" resultType="ldn.cs.fusion.pojo.staff.Staff">
        select * from tbl_staff_info_original
        <where>
            1=1
            <if test="statement != null and statement != ''">
                <if test="types == 1">
                    AND corporation = #{statement}
                </if>
                <if test="types == 2">
                    AND updateTime = #{statement}
                </if>
            </if>
        </where>
        LIMIT #{limit} OFFSET #{offset}
    </select>

    <!-- 查询StaffInfos报表Total -->
    <select id="getTotalStaff" resultType="int">
        select count(1) from tbl_staff_info_original
        <where>
            1=1
            <if test="statement != null and statement != ''">
                <if test="types == 1">
                    AND corporation = #{statement}
                </if>
                <if test="types == 2">
                    AND updateTime = #{statement}
                </if>
            </if>
        </where>
    </select>

    <!-- 新增Person数据 -->
    <insert id="addPersonInfos" parameterType="ldn.cs.fusion.pojo.staff.Person">
        INSERT INTO tbl_staff_person_info(corporation,categories, eventTime, updateTime)
        VALUES
        <foreach collection="persons" item="person" separator=",">
            (#{person.corporation}, #{person.categories}, #{person.eventTime}, #{person.updateTime})
        </foreach>
    </insert>

    <!-- 查询Person数据 -->
    <select id="getPersonInfos" resultType="ldn.cs.fusion.pojo.staff.Person">
        select * from tbl_staff_person_info
        <where>
            <if test="granularity != null and granularity != ''">
                <choose>
                    <when test="granularity == 1">
                        YEAR(FROM_UNIXTIME(eventTime / 1000)) = #{time}
                    </when>
                    <when test="granularity == 2">
                        QUARTER(FROM_UNIXTIME(eventTime / 1000)) = #{time}
                    </when>
                    <when test="granularity == 3">
                        MONTH(FROM_UNIXTIME(eventTime / 1000)) = #{time}
                    </when>
                </choose>
            </if>
        </where>
    </select>

</mapper>